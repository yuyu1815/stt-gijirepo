# junie AIエージェント コードチェックガイドライン

このドキュメントは、junie AIエージェントプロジェクトにおいて、コードの品質を維持・向上させるためのチェックプロセスに関するガイドラインです。前回の「Pythonコーディングガイドライン」に加えて、具体的なチェック方法やツールについて定めます。

## 1. はじめに

コードチェックは、バグの早期発見、コードの一貫性維持、可読性の向上、チーム開発の効率化に不可欠です。このガイドラインに従い、品質の高いコードベースを維持しましょう。

## 2. コードチェックの種類

以下の種類のコードチェックを実施します。

* **静的解析 (Static Analysis):**
    * **コードフォーマット:** コーディングスタイル（インデント、スペース、改行など）が統一されているかチェックし、自動修正します。
    * **コードスタイル/Linting:** PEP 8などのスタイルガイドに準拠しているか、潜在的なバグの原因となるコードパターン（未使用変数、到達不能コードなど）がないかチェックします。
* **型チェック (Type Checking):** 型ヒントが正しく記述されており、型の整合性が保たれているかチェックします。
* **テスト実行 (Test Execution):** 単体テスト、統合テストなどを実行し、コードが期待通りに機能するか確認します。
* **セキュリティチェック (Security Analysis):** 既知のセキュリティ脆弱性パターンを含んでいないか、基本的なセキュリティルールに準拠しているかチェックします（プロジェクトの要件に応じて）。
* **コードレビュー (Code Review):** 人間によるコードの確認です。論理的な誤り、設計上の問題、可読性、ガイドライン遵守などをチェックします。

## 3. 推奨ツール

上記のチェックを実施するために、以下のツール群の使用を推奨または必須とします。これらのツールは、プロジェクトの依存関係として管理し、設定ファイル（例: `pyproject.toml`, `.flake8`, `mypy.ini`など）で管理します。

* **コードフォーマット:**
    * `black`: 議論の余地のないフォーマッター。設定が少なく、コードスタイルを自動的に統一できます。
* **コードスタイル/Linting:**
    * `flake8`: PEP 8準拠チェック、pyflakes (潜在的なバグ検出)、mccabe (循環的複雑度チェック) を組み合わせたツール。様々なプラグインも利用可能です。
* **型チェック:**
    * `mypy`: Pythonの静的型チェッカー。型ヒントが正しく使用されているか検証します。
* **テストフレームワーク:**
    * `pytest`: 非常に人気のあるPythonのテストフレームワーク。シンプルなテスト記述と豊富なプラグインが特徴です。(`unittest`を使用している場合は引き続き使用しても構いません)
* **セキュリティチェック:**
    * `bandit`: Pythonコード内の一般的なセキュリティ上の問題点を検出します。
* **依存関係ソート:**
    * `isort`: インポート文を自動的にソートします。

## 4. チェックの実行タイミング

コードチェックは、開発サイクルの様々な段階で実行します。

* **ローカル開発時:** 開発者は、コードをコミットする前に、ローカル環境で静的解析、型チェック、テストを実行し、問題がないことを確認します。
    * `black <ファイル名>` または `black .`
    * `flake8 <ファイル名>` または `flake8 .`
    * `mypy <ファイル名>` または `mypy .`
    * `pytest`
    * `bandit <ディレクトリ名>` (必要に応じて)
* **コミット前/プッシュ前フック:** Gitのpre-commitやpre-pushフックを使用して、自動的にフォーマット、linting、基本的なテストを実行するように設定することを強く推奨します。これにより、不正なコードがリポジトリにプッシュされるのを防ぎます。`pre-commit`フレームワークの使用が便利です。
* **プルリクエスト時 (CI):** GitHub Actions, GitLab CI, JenkinsなどのCI/CDパイプライン上で、プルリクエストが作成または更新されるたびに、自動的に全ての静的解析、型チェック、テスト、セキュリティチェックを実行します。**CIのチェックにパスしないプルリクエストはマージできません。**

## 5. 違反時の対応

コードチェックツールによって違反が検出された場合は、以下の対応を行います。

* **静的解析/型チェック/セキュリティチェックの違反:** CIでエラーとなった場合、コードを修正して再度コミット・プッシュし、CIがパスするようにします。自動修正可能な項目（フォーマット、インポートソートなど）はツールを使用して修正します。
* **テストの失敗:** テストコードまたはプロダクションコードのバグを修正し、テストがパスするようにします。必要に応じてテストケースを更新または追加します。
* **コードレビューの指摘:** レビュアーからのフィードバックを確認し、コードの修正が必要な場合は修正を行います。レビュアーと議論が必要な場合は、建設的にコミュニケーションを取ります。

## 6. チェック対象範囲

原則として、junieリポジトリ内の**全てのPythonコード**（アプリケーションコード、テストコード、スクリプト、設定ファイルなど）をチェック対象とします。ただし、外部ライブラリや自動生成されたコードなど、チェックから除外すべきファイルやディレクトリは、ツールの設定ファイルで適切に指定します。

## 7. コードレビューの進め方

プルリクエストベースでコードレビューを実施します。

* **レビューの観点:**
    * **機能:** 実装が要求仕様を満たしているか。
    * **設計:** コードの構成、クラスや関数の責務分担が適切か。
    * **可読性:** コードが理解しやすいか、命名が適切か。
    * **保守性:** 将来の変更が容易なコードになっているか。
    * **テスト:** 適切なテストが書かれているか、既存のテストが壊れていないか。
    * **ドキュメント:** Docstringやコメントが必要十分か。
    * **ガイドライン遵守:** このドキュメントおよびコーディングガイドラインに沿っているか。
* **フィードバック:** 具体的に、建設的にフィードバックを行います。問題を指摘するだけでなく、改善案を提示することも奨励します。
* **マージ:** 少なくとも一人のレビュアーからの承認を得て、かつ全ての自動チェックがパスした場合にのみマージを許可します。

## 8. 継続的な改善

このガイドラインおよび使用するツール、設定は、開発の進捗や新しい知見に基づいて定期的に見直し、改善していきます。より効果的なチェック方法や新しいツールがあれば、チームで評価し導入を検討します。

このガイドラインが、junie AIエージェントプロジェクトにおけるコード品質管理の一助となれば幸いです。

---